# JVM 虚拟机
    （JVM，Java Virtual Machine）
    （ˈdʒɑːvə ˈvɜːtʃuəl məˈʃiːn）

## 结构简图
        
                       ┌──────────────────────────────┐                                
                       │        Java源文件 (.java)     │                                
                       └────────────┬─────────────────┘                                
                                    ▼                                                  
                       ┌──────────────────────────────┐                                
                       │        Java编译器 (javac)     │                                
                       └────────────┬─────────────────┘                                
                                    ▼                                                  
                       ┌──────────────────────────────┐                                
                       │        字节码文件 (.class)    │                                
                       └────────────┬─────────────────┘                                
                                    ▼                                                  
                  ┌──────────────────────────────────────────┐                         
                  │               Java虚拟机 JVM              │                         
                  └──────────────────────────────────────────┘                         
                                    │                                                  
               ┌────────────────────┼────────────────────────┐                         
               ▼                    ▼                        ▼                         
        ┌──────────────┐  ┌────────────────┐     ┌─────────────────────┐               
        │ 类加载子系统  │  │ 内存管理子系统  │     │ 执行引擎             │               
        └──────────────┘  └────────────────┘     └─────────────────────┘               
                              │                         │                              
                ┌─────────────┼─────────────┐     ┌─────┼─────┐                        
                ▼             ▼             ▼     ▼           ▼                        
        ┌────────────┐  ┌─────────────┐  ┌────────────┐   ┌────────────┐               
        │ 方法区      │  │ 堆内存      │  │ 本地方法接口│   │  本地方法库  │              
        └────────────┘  └─────────────┘  └────────────┘   └────────────┘               

## 核心组件

### 一. 类加载子系统 （Class Loader Subsystem）

>
> 职责：负责将.class字节码文件加载到内存，并为其创建Class对象
> 
> 过程：加载（Loading）-> 验证（Verification） -> 准备（Preparation） -> 解析（Resolution） -> 初始化（Initialization）
>
> 类加载器种类：
> 
>> 1. 引导类加载器（Bootstrap ClassLoader）   ： 加载JAVA_HOME/lib下的核心类。
>> 2. 扩展类加载器（Extension ClassLoader）   ： 加载JAVA_HOME/lib/ext下的类。
>> 3. 应用类扩展器（Application ClassLoader） ： 加载应用程序的classpath中的类。

### 二. 运行时数据区 （Runtime Data Area）

>
> 1. 方法区（Method Area）【共享内存】
>>
>> 存储类的元信息（类名、访问修饰符、字段、方法、静态变量等）。
>>
>> 被所有线程共享。
>>
>> 在JDK8之前是永久代（PermGen），JDK8之后被元空间（Metaspace）替代，位于本地内存中。
> 
> 2. 堆内存（Heap）【共享内存】
>>
>> 存储对象实例和数组。
>>
>> 是GC（垃圾回收期）管理的主要区域。
>>
>> 被所有线程共享
>>
>> 又细分为：
>>>
>>> 年轻代（Young Generation） ： 包括 Eden、Survivor 0 （səˈvaɪvə）、Survivor 1
>>>
>>> 老年代（Old Generation）
>>
> 3. 虚拟机栈（JVM Stack）【私有内存】
>>
>> 每个线程创建时都会创建自己的JVM栈。
>>
>> 每个方法调用会创建一个栈帧（Stack Frame），存储局部变量表、操作数栈、方法返回地址等。
>>
>> 若栈深度过深，会导致 StackOverflowError。
>
> 4. 本地方法栈（Native Method Stack）
>>
>> 为执行Native方法服务（如调用C/C++函数）。
>>
>> 与虚拟机栈类似，但转为native代码设计。
>
> 5. 程序计数器（Program Counter Register）
>>
>> 每个线程私有。
>>
>> 记录当前线程所执行的字节码行号指令地址。
>>
>> 如果正在执行的是native方法，该计数器置为undefined。

### 三. 执行引擎（Execution Engine）

    职责：负责执行字节码文件。
    包括以下三个部分：

> 1. 解释器（Interpreter）
>>
>> 将字节码逐行解释为机器指令。
>>
>> 启动快，但运行慢。
>
> 2. 即时编译器（JTI Compiler）
>>
>> 将热点代码编译成本地机器码，提高性能。
>>
>> 常用的有C1（client）和C2（server）编译器。
>
> 3. 垃圾回收期（Garbage Collector）
>>
>> 负责回收堆中的无用对象。
>>
>> 多种算法： 标记-清除、复制算法、标记-整理。
>>
>> 常见GC类型：Serial、Paraller、CMS、G1、ZGC、Shenandoah。

### 四. 本地接口（Native Interface）

> JVM调用非Java代码的通道，如C、C++。
> 
> 通过JNI（Java Native Interface）实现。
> 
> 作用：调用操作系统API，或者重用已有的C/C++库。

### 五. Java Native Libraries

    本地方法所依赖的共享库，如.dll(Windows)、.so（Linux）。

### 六. JVM架构总结

    JVM像一个虚拟“操作系统”，
        负责加载类（类加载器）
        分配和管理内存（内存区域）
        执行代码（执行引擎）
        清理垃圾（GC）
        连接本地（JNI）



    








































